<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>7.4. Notes - optrace 1.7.5 documentation</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="7.5. Changelog" href="changelog.html" /><link rel="prev" title="7.3. Packaging" href="packaging.html" />
      <link rel="canonical" href="https://drocheam.github.io/optrace/development/notes.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=a318c5d4" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=81da21d3" />
    <!--intentionally blank so there are no external fonts loaded-->
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://drocheam.github.io/optrace/development/notes.html"/>
  <meta property="og:title" content="7.4. Notes"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>optrace</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href=".././examples.html">Examples</a></li><li class="link"><a href=".././installation.html">Installation</a></li><li class="link"><a href=".././usage/index.html">User Guide</a></li><li class="link">
          <a href="https://github.com/drocheam/optrace">
            <span>GitHub Repo</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><!--custom github logo so we don't need to connect to some icon provider-->
<div class="sy-head-socials"><a href="https://github.com/drocheam/optrace" aria-label="GitHub">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
  <a href="https://github.com/drocheam/optrace/releases" aria-label="Releases">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-icon lucide-package"><path d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"/><path d="M12 22V12"/><polyline points="3.29 7 12 12 20.71 7"/><path d="m7.5 4.27 9 5.15"/></svg>
  </a>
</div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../examples.html">1. Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">4. User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/overview.html">4.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/surfaces.html">4.2. Base Shapes (Surface, Line, Point)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/elements.html">4.3. Elements (Lens, Ray Source,  ‚Ä¶)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/group.html">4.4. Geometry Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/raytracer.html">4.5. Raytracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/refraction_index.html">4.6. Refractive Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/spectrum.html">4.7. Spectrum Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/image.html">4.8. Image Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/focus.html">4.9. Focus Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/tma.html">4.10. Paraxial Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/convolve.html">4.11. PSF Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/plots.html">4.12. Plotting Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/gui.html">4.13. GUI Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/gui_automation.html">4.14. GUI Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/advanced.html">4.15. Advanced Topics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../details/index.html">5. Implementation Details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../details/sampling.html">5.1. Property Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/tracing.html">5.2. Tracing Procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/hurb.html">5.3. Heisenberg Uncertainty Ray Bending</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/image_spectrum.html">5.4. Image and Spectrum Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/matrix_analysis.html">5.5. Ray Transfer Matrix Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/convolution.html">5.6. PSF Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/focus.html">5.7. Focus Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/color.html">5.8. Color Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/misc.html">5.9. Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">6. API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/structure.html">6.1. Library Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace.html">6.2. Global Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer.html">6.3. tracer Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_color.html">6.4. tracer.color Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_geometry.html">6.5. tracer.geometry Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_geometry_surface.html">6.6. tracer.geometry.surface Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_image.html">6.7. tracer.image Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_spectrum.html">6.8. tracer.spectrum Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_presets.html">6.9. tracer.presets Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_plots.html">6.10. plots Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_gui.html">6.11. gui Submodule</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">7. Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="testing.html">7.1. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">7.2. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="packaging.html">7.3. Packaging</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.4. Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html">7.5. Changelog</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">optrace</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name"><span class="section-number">7. </span>Development</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name"><span class="section-number">7.4. </span>Notes</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://drocheam.github.io/optrace/_sources/development/notes.rst.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://drocheam.github.io/optrace/_sources/development/notes.rst.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://drocheam.github.io/optrace/_sources/development/notes.rst.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:code-slash"></iconify-icon>
            <span>View Source</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//drocheam.github.io/optrace/_sources/development/notes.rst.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//drocheam.github.io/optrace/_sources/development/notes.rst.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue" role="main">
          <section id="notes">
<span id="dev-notes"></span><h1><span class="section-number">7.4. </span>Notes<a class="headerlink" href="#notes" title="Link to this heading">¬∂</a></h1>
<p><strong>Library Design</strong></p>
<ul class="simple">
<li><p>modular design with multiple submodules</p></li>
<li><p>plotting and TraceGUI are independent of the tracing backend</p></li>
<li><p>automation/scripting easily possible</p></li>
<li><p>platform independent and open source</p></li>
<li><p>importing only the backend tracing functionality does not import GUI and plotting libraries. This ensures better performance and enables us to use this functionality without ever needing to install this heavy libraries when they are never needed.</p></li>
</ul>
<p><strong>Dependencies</strong></p>
<ul class="simple">
<li><p>balance of minimizing dependencies while also trying not to implement too much manually</p></li>
<li><p>outsource GUI and plotting functionality/backend to external libraries</p></li>
<li><p>tracing, color conversion, geometry manipulations etc. are implemented in library itself</p></li>
<li><p>prefer python standard libraries</p></li>
<li><p>only use open source dependencies</p></li>
</ul>
<p><strong>Documentation Style</strong></p>
<ul class="simple">
<li><p>publication-like design</p></li>
<li><p>LaTeX equations (ü†™ <a class="reference external" href="https://www.mathjax.org/">MathJax</a>)</p></li>
<li><p>citations and bibliography (ideally per webpage)</p></li>
<li><p>clickable references to sections, table, equations, citations</p></li>
<li><p>keyword/topic index</p></li>
<li><p>no use of external images (so no copyright/licensing issues)</p></li>
</ul>
<p><strong>Graphical Outputs</strong></p>
<ul class="simple">
<li><p>professional, publication-like plots</p></li>
<li><p>prefer serif fonts (e.g. Times New Roman)</p></li>
<li><p>use LaTeX formatted equations/labels</p></li>
<li><p>highlight more important elements by colors, font size or boldness</p></li>
<li><p>axes, minor and major grid lines, titles and legend are a must</p></li>
<li><p><a class="reference internal" href="../reference/optrace_plots.html#optrace.plots.misc_plots.block" title="optrace.plots.misc_plots.block"><code class="xref py py-func docutils literal notranslate"><span class="pre">block</span></code></a> function allows for halting the rest of the program when plotting</p></li>
<li><p>options for hiding some visual elements (labels, axes in GUI, legend entries)</p></li>
<li><p>prefer svg for self-created figures, png for screenshots and webp for rendered images</p></li>
<li><p>use tinypng to shrink pngs for the webpage, vecta.io for pyplot svgs</p></li>
<li><p>in some cases there are issues with webp output in chromatic channels, export in lossless webp in these cases</p></li>
</ul>
<p><strong>Multithreading and Multiprocessing</strong></p>
<ul class="simple">
<li><p>outsource heavy tasks onto multiple cores</p></li>
<li><dl class="simple">
<dt>prefer threads over processes (no copying overhead). However we need to:</dt><dd><ul>
<li><p>ensure there are no race conditions by using locks or by ensuring each thread writes on a different memory location</p></li>
<li><p>minimize python code (because of the GIL limitation while multithreading). Use lower level libraries with like numpy</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>all worker and background threads need to terminate immediately when the main thread has ended
This is ensured by providing <code class="code highlight python docutils literal highlight-python"><span class="n">daemon</span><span class="o">=</span><span class="kc">True</span></code> while creating the <a class="reference external" href="https://docs.python.org/3/library/threading.html#threading.Thread" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code></a> object.</p></li>
<li><p>multithreading should be controlled with a <a class="reference internal" href="../reference/optrace.html#optrace.global_options.ClassGlobalOptions.multithreading" title="optrace.global_options.ClassGlobalOptions.multithreading"><code class="xref py py-attr docutils literal notranslate"><span class="pre">multithreading</span></code></a> global option</p></li>
<li><dl class="simple">
<dt>threading rules for <a class="reference internal" href="../reference/optrace_gui.html#optrace.gui.trace_gui.TraceGUI" title="optrace.gui.trace_gui.TraceGUI"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceGUI</span></code></a>, with some ideas from <a class="reference external" href="https://traits-futures.readthedocs.io/en/latest/guide/threading.html">traits Futures</a></dt><dd><ul>
<li><p>GUI changes only in main thread</p></li>
<li><p>GUI must be responsive at all costs</p></li>
<li><p>simplified Read/Write access model: only one thread can read and write</p></li>
<li><p>no locks in the main thread, waiting for locks only in worker threads</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Performance and Memory</strong></p>
<ul class="simple">
<li><p>use of multithreading</p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v2.4)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code></a> where possible</p></li>
<li><p>avoid loops</p></li>
<li><p>work with object references when possible (instead of copies)</p></li>
<li><p>use masks on arrays instead of creating new ones</p></li>
<li><p>only do calculations on elements actually needed</p></li>
<li><p>pre-allocation instead of growing an array step by step</p></li>
<li><p>use <code class="code highlight python docutils literal highlight-python"><span class="n">np</span><span class="o">.</span><span class="n">float32</span></code> or <code class="code highlight python docutils literal highlight-python"><span class="nb">int</span></code> instead of <code class="code highlight python docutils literal highlight-python"><span class="n">np</span><span class="o">.</span><span class="n">float64</span></code> where high precision is not needed</p></li>
<li><p>prefer analytical solutions instead of iterative numerical approximations</p></li>
<li><p>multi-dimensional array access can be accelerated by choosing a specific memory layout of the
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> (<code class="code highlight python docutils literal highlight-python"><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span></code> etc.)</p></li>
<li><p>always keep the GUI responsive</p></li>
<li><p>range indexing (<code class="code highlight python docutils literal highlight-python"><span class="n">array</span><span class="p">[</span><span class="mi">52</span><span class="p">:</span><span class="mi">79829</span><span class="p">]</span></code>) is faster than boolean indexing
(<code class="code highlight python docutils literal highlight-python"><span class="n">array</span><span class="p">[[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]]</span></code>,  which is faster than indexing by index list
(<code class="code highlight python docutils literal highlight-python"><span class="n">array</span><span class="p">[[</span><span class="mi">52</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">897987</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span></code>)</p></li>
<li><p>a reasonable amount of points and curves in plots</p></li>
<li><p>limit array sizes</p></li>
<li><p>As there is no compilation, there is almost no optimization:
For an array <code class="code highlight python docutils literal highlight-python"><span class="n">a</span></code> and constants: <code class="code highlight python docutils literal highlight-python"><span class="mi">1</span><span class="o">/</span><span class="n">const</span><span class="o">*</span><span class="n">a</span></code> is faster than <code class="code highlight python docutils literal highlight-python"><span class="n">a</span><span class="o">/</span><span class="n">const</span></code>,
even <code class="code highlight python docutils literal highlight-python"><span class="n">a</span> <span class="o">*=</span> <span class="mi">1</span><span class="o">/</span><span class="n">const</span></code> is actually faster than <code class="code highlight python docutils literal highlight-python"><span class="n">a</span> <span class="o">/=</span> <span class="n">const</span></code>.
<code class="code highlight python docutils literal highlight-python"><span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">const2</span> <span class="o">+</span> <span class="n">const1</span><span class="p">)</span></code> is faster than <code class="code highlight python docutils literal highlight-python"><span class="n">const1</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">const2</span></code>.
<code class="code highlight python docutils literal highlight-python"><span class="n">a</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></code> is faster than <code class="code highlight python docutils literal highlight-python"><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code>.</p></li>
<li><p>Indexing can be costly due to copying and RAM usage. Sometimes running the default case for all rays and
only indexing and treating the special rays afterwards is much faster. (Instead of indexing the arrays
for both cases and creating copies).</p></li>
</ul>
<p><strong>File Input/Output</strong></p>
<ul class="simple">
<li><p>OS independent file names</p></li>
<li><p>store under a fallback path when files exists or can‚Äôt be written</p></li>
<li><p>write file in one go, don‚Äôt append iteratively</p></li>
<li><p>use external libraries for loading special files (images, spreadsheets etc.)</p></li>
<li><p>use <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.savez.html">compressed numpy archives</a> (<code class="docutils literal notranslate"><span class="pre">.npz</span></code>) to save some space</p></li>
<li><p>try to detect the correct text encoding before loading any clear text formats. Outsource this to <a class="reference external" href="https://github.com/chardet/chardet">chardet</a></p></li>
</ul>
<p><strong>Type and Value Checking</strong></p>
<ul class="simple">
<li><p>functions and classes that are exposed to the user should have type and value checking</p></li>
<li><dl class="simple">
<dt>some people will tell you ‚Äúthis is not the pythonic way‚Äù, however:</dt><dd><ul>
<li><p>clear error messages are more helpful than needing to debug for 30 minutes</p></li>
<li><p>some values produce results that are valid mathematically, but impossible according to physics (e.g. negative energies, zero sized geometries etc.).</p></li>
<li><p>even I as developer do not remember the types and value ranges for all parameters and the correct function usage</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Object and Geometry Locks</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Class functions change parameters of the object itself, assigning parameters directly to the object can break things. Hard to debug, very frustrating.</dt><dd><ul>
<li><p>e.g. the surface height depends on the surface parameters. Changing one without the other leads to very weird issues</p></li>
<li><p>This however depends on the parameters/variables and their roles.</p></li>
<li><p>Some parameters are even read-only.</p></li>
<li><p>a change is not propagated to the parent/child object</p></li>
<li><p>we can‚Äôt expect the user to know where assignments are possible without side effects and where not.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>‚ûú restricting assignments</dt><dd><ul>
<li><p>lock the geometry of an <code class="code highlight python docutils literal highlight-python"><span class="n">Element</span></code>, surfaces can only be assigned by special functions,
the position can only be changed with a dedicated method</p></li>
<li><p>lock objects like a <code class="code highlight python docutils literal highlight-python"><span class="n">Surface</span></code> to avoid nasty side effects</p></li>
<li><p>allow assignments where possible</p></li>
<li><p>make numpy arrays read-only while locking</p></li>
<li><p>locking can still be turned off manually when knowing about the internal mechanism,
but at that point the user should have noticed that changing the code in such a way was not intended by the library</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Coding Style</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CamelCase</span></code> class names, <code class="docutils literal notranslate"><span class="pre">lower_case_with_underscores</span></code> for functions, filenames, parameters.
Note that the latter this is not always possible for mathematical or physical quantities with standardized symbols</p></li>
<li><p>increased line length of 120 characters</p></li>
<li><p>prefer writing out keyword arguments (<code class="code highlight python docutils literal highlight-python"><span class="n">function</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1026</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4596</span><span class="p">)</span></code>)
for readability and simpler documentation</p></li>
<li><p>use of docstrings for functions, classes and important variables</p></li>
</ul>
<p><strong>Standard Output</strong></p>
<ul class="simple">
<li><p>functions and classes output information and warnings to the terminal</p></li>
<li><p>warnings have an own type <a class="reference internal" href="../reference/optrace.html#optrace.warnings.OptraceWarning" title="optrace.warnings.OptraceWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptraceWarning</span></code></a>
and can be silenced with a global option
<a class="reference internal" href="../reference/optrace.html#optrace.global_options.ClassGlobalOptions.show_warnings" title="optrace.global_options.ClassGlobalOptions.show_warnings"><code class="xref py py-attr docutils literal notranslate"><span class="pre">show_warnings</span></code></a></p></li>
<li><p>the progressbar should only used for more time-intensive tasks and can be turned off with the
<a class="reference internal" href="../reference/optrace.html#optrace.global_options.ClassGlobalOptions.show_progress_bar" title="optrace.global_options.ClassGlobalOptions.show_progress_bar"><code class="xref py py-attr docutils literal notranslate"><span class="pre">show_progressbar</span></code></a> option.</p></li>
</ul>
<p><strong>Responsiveness</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>some actions need time, but the program should still appear active and responsive. Hence, we need to notify the user with:</dt><dd><ul>
<li><p>a message that something has been started / processed/ approved</p></li>
<li><p>a progress bar indicating the progress and estimated remaining time.
Also distracts the user, lowering the subjective waiting time</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>TraceGUI actions like tracing, focussing etc. need to run in background threads,
so the scene and main UI thread are responsive</p></li>
</ul>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="packaging.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title"><span class="section-number">7.3. </span>Packaging</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="changelog.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title"><span class="section-number">7.5. </span>Changelog</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright">
      &copy; 2026, Damian Mendroch &nbsp;  &nbsp; 
      <a href="../impressum.html" style="color: var(--pst-color-text-muted)">Impressum</a>
      &nbsp; &nbsp; 
      <a href="../impressum.html" style="color: var(--pst-color-text-muted)">Legal Notice</a>
      <br>
  
    </div>
    <div class="sy-foot-copyright">
      <p>
        Made with
    
        <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
        <a href="https://shibuya.lepture.com">Shibuya theme</a>.
      </p>
    </div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5b045848"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>