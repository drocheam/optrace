<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>4.15. Advanced Topics - optrace 1.7.5 documentation</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="5. Implementation Details" href="../details/index.html" /><link rel="prev" title="4.14. GUI Automation" href="gui_automation.html" />
      <link rel="canonical" href="https://drocheam.github.io/optrace/usage/advanced.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=d48c410d" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=81da21d3" />
    <!--intentionally blank so there are no external fonts loaded-->
    <meta property="og:type" content="website"/>
<meta property="og:url" content="https://drocheam.github.io/optrace/usage/advanced.html"/>
<meta property="og:title" content="4.15. Advanced Topics"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>optrace</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href=".././examples.html">Examples</a></li><li class="link"><a href=".././installation.html">Installation</a></li><li class="link"><a href=".././usage/index.html">User Guide</a></li><li class="link">
          <a href="https://github.com/drocheam/optrace">
            <span>GitHub Repo</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><!--custom github logo so we don't need to connect to some icon provider-->
<div class="sy-head-socials"><a href="https://github.com/drocheam/optrace" aria-label="GitHub">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
  <a href="https://github.com/drocheam/optrace/releases" aria-label="Releases">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-icon lucide-package"><path d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"/><path d="M12 22V12"/><polyline points="3.29 7 12 12 20.71 7"/><path d="m7.5 4.27 9 5.15"/></svg>
  </a>
</div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../examples.html">1. Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">4.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="surfaces.html">4.2. Base Shapes (Surface, Line, Point)</a></li>
<li class="toctree-l2"><a class="reference internal" href="elements.html">4.3. Elements (Lens, Ray Source,  â€¦)</a></li>
<li class="toctree-l2"><a class="reference internal" href="group.html">4.4. Geometry Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="raytracer.html">4.5. Raytracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="refraction_index.html">4.6. Refractive Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html">4.7. Spectrum Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="image.html">4.8. Image Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="focus.html">4.9. Focus Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="tma.html">4.10. Paraxial Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="convolve.html">4.11. PSF Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="plots.html">4.12. Plotting Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui.html">4.13. GUI Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_automation.html">4.14. GUI Automation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.15. Advanced Topics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../details/index.html">5. Implementation Details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../details/sampling.html">5.1. Property Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/tracing.html">5.2. Tracing Procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/hurb.html">5.3. Heisenberg Uncertainty Ray Bending</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/image_spectrum.html">5.4. Image and Spectrum Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/matrix_analysis.html">5.5. Ray Transfer Matrix Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/convolution.html">5.6. PSF Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/focus.html">5.7. Focus Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/color.html">5.8. Color Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../details/misc.html">5.9. Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">6. API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/structure.html">6.1. Library Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace.html">6.2. Global Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer.html">6.3. tracer Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_color.html">6.4. tracer.color Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_geometry.html">6.5. tracer.geometry Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_geometry_surface.html">6.6. tracer.geometry.surface Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_image.html">6.7. tracer.image Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_spectrum.html">6.8. tracer.spectrum Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_presets.html">6.9. tracer.presets Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_plots.html">6.10. plots Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_gui.html">6.11. gui Submodule</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">7. Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/testing.html">7.1. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/documentation.html">7.2. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/packaging.html">7.3. Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/notes.html">7.4. Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/changelog.html">7.5. Changelog</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#raytracing-errors">4.15.1. Raytracing Errors</a></li>
<li><a class="reference internal" href="#accessing-ray-properties">4.15.2. Accessing Ray Properties</a><ul>
<li><a class="reference internal" href="#overview">4.15.2.1. Overview</a></li>
<li><a class="reference internal" href="#direct-access">4.15.2.2. Direct Access</a></li>
<li><a class="reference internal" href="#masking">4.15.2.3. Masking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#object-descriptions">4.15.3. Object Descriptions</a></li>
<li><a class="reference internal" href="#modifying-initialized-objects">4.15.4. Modifying Initialized Objects</a></li>
<li><a class="reference internal" href="#color-conversions">4.15.5. Color Conversions</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">optrace</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name"><span class="section-number">4. </span>User Guide</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name"><span class="section-number">4.15. </span>Advanced Topics</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="advanced-topics">
<h1><span class="section-number">4.15. </span>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">Â¶</a></h1>
<section id="raytracing-errors">
<h2><span class="section-number">4.15.1. </span>Raytracing Errors<a class="headerlink" href="#raytracing-errors" title="Link to this heading">Â¶</a></h2>
<p>The raytracer emits warnings and errors while simulating.
Internally these are characterized by flags, which can be found below:</p>
<div class="table-wrapper colwidths-given docutils container" id="id1">
<table class="docutils align-left" id="id1" style="width: 900px">
<caption><span class="caption-number">Table 4.24 </span><span class="caption-text">List of raytracing messages</span><a class="headerlink" href="#id1" title="Link to this table">Â¶</a></caption>
<colgroup>
<col style="width: 14.3%" />
<col style="width: 85.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Flag</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.raytracer.Raytracer.INFOS.ABSORB_MISSING" title="optrace.tracer.raytracer.Raytracer.INFOS.ABSORB_MISSING"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raytracer.INFOS.ABSORB_MISSING</span></code></a></p></td>
<td><p>Rays are absorbed because they miss a lens surface.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.raytracer.Raytracer.INFOS.TIR" title="optrace.tracer.raytracer.Raytracer.INFOS.TIR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raytracer.INFOS.TIR</span></code></a></p></td>
<td><p>Total inner reflection. Reflections are not simulated, so the ray is treated as being absorbed at the surface intersection</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.raytracer.Raytracer.INFOS.ILL_COND" title="optrace.tracer.raytracer.Raytracer.INFOS.ILL_COND"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raytracer.INFOS.ILL_COND</span></code></a></p></td>
<td><p>Ill-conditioned rays for hit finding of a numerical, custom surface. In almost all cases the intersection will be wrong. This can happen if the surface is badly defined numerically or geometrically, there are surface collisions or a ray hits the surface multiple times. Please check the geometry of the raytracer and the surface definition.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.raytracer.Raytracer.INFOS.OUTLINE_INTERSECTION" title="optrace.tracer.raytracer.Raytracer.INFOS.OUTLINE_INTERSECTION"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raytracer.INFOS.OUTLINE_INTERSECTION</span></code></a></p></td>
<td><p>Rays that would leave the outline are absorbed at the outline intersection</p></td>
</tr>
</tbody>
</table>
</div>
<p>The raytracer also provides a <a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.raytracer.Raytracer.geometry_error" title="optrace.tracer.raytracer.Raytracer.geometry_error"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Raytracer.geometry_error</span></code></a> flag that gets set when tracing was aborted due to issues with the geometry.
Geometry checks are only executed while tracing, so <a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.raytracer.Raytracer.trace" title="optrace.tracer.raytracer.Raytracer.trace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Raytracer.trace</span></code></a> must be called first.</p>
<p>When using the GUI, a subset of surface collision points will also be displayed in the geometry.</p>
</section>
<section id="accessing-ray-properties">
<span id="usage-ray-access"></span><h2><span class="section-number">4.15.2. </span>Accessing Ray Properties<a class="headerlink" href="#accessing-ray-properties" title="Link to this heading">Â¶</a></h2>
<section id="overview">
<h3><span class="section-number">4.15.2.1. </span>Overview<a class="headerlink" href="#overview" title="Link to this heading">Â¶</a></h3>
<p><strong>Definitions:</strong></p>
<div class="line-block">
<div class="line"><strong>Ray Section</strong>: Part of the ray with a constant direction vector. Sections typically start and end at surface intersections.</div>
<div class="line"><strong>Ray</strong>: Entirety of the ray going from the source to its absorption</div>
<div class="line"><strong>N</strong>: number of rays</div>
<div class="line"><strong>Nt</strong>: number of sections per ray, equal for all rays</div>
</div>
<p>The number of sections is the same for all rays.
If a ray gets absorbed early, all consecutive sections consist of zero length vectors starting at the last position and having their power set to zero.
Direction and polarization are then undefined.</p>
<p>The following table shows an overview of ray properties.
Some of those are attributes that are stored while tracing, while others are functions, as these properties must be calculated from other attributes first.
They are intentionally kept as functions and are not exposed as properties, so an computational overhead is communicated to the user.</p>
<div class="table-wrapper colwidths-given docutils container" id="id2">
<table class="docutils align-left" id="id2" style="width: 900px">
<caption><span class="caption-number">Table 4.25 </span><span class="caption-text">List of ray properties</span><a class="headerlink" href="#id2" title="Link to this table">Â¶</a></caption>
<colgroup>
<col style="width: 11.8%" />
<col style="width: 11.8%" />
<col style="width: 23.5%" />
<col style="width: 5.9%" />
<col style="width: 47.1%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Quantity</p></th>
<th class="head"><p>Method/Attribute</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Position</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.p_list" title="optrace.tracer.ray_storage.RayStorage.p_list"><code class="xref py py-attr docutils literal notranslate"><span class="pre">p_list</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float64</span></code></a> of shape (N, Nt, 3)</p></td>
<td><p>mm</p></td>
<td><p>3D starting position for all ray sections</p></td>
</tr>
<tr class="row-odd"><td><p>Direction vectors</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.direction_vectors" title="optrace.tracer.ray_storage.RayStorage.direction_vectors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">direction_vectors()</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float64</span></code></a> of shape (N, Nt, 3)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td><p>normalized (with <code class="code highlight python docutils literal highlight-python"><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span></code>) or unnormalized direction vectors for each ray section</p></td>
</tr>
<tr class="row-even"><td><p>Section lengths</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.ray_lengths" title="optrace.tracer.ray_storage.RayStorage.ray_lengths"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ray_lengths()</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float64</span></code></a> of shape (N, Nt)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td><p>geometrical length of each ray section</p></td>
</tr>
<tr class="row-odd"><td><p>Optical section lengths</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.optical_lengths" title="optrace.tracer.ray_storage.RayStorage.optical_lengths"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optical_lengths()</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float64</span></code></a> of shape (N, Nt)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td><p>optical length of each ray section (geometrical length multiplied by refractive index)</p></td>
</tr>
<tr class="row-even"><td><p>Polarization</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.pol_list" title="optrace.tracer.ray_storage.RayStorage.pol_list"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pol_list</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float32</span></code></a> of shape (N, Nt, 3)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td><p>unity 3D polarization vector</p></td>
</tr>
<tr class="row-odd"><td><p>Power</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.w_list" title="optrace.tracer.ray_storage.RayStorage.w_list"><code class="xref py py-attr docutils literal notranslate"><span class="pre">w_list</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float32</span></code></a> of shape (N, Nt)</p></td>
<td><p>W</p></td>
<td><p>ray power</p></td>
</tr>
<tr class="row-even"><td><p>Refractive Index</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.n_list" title="optrace.tracer.ray_storage.RayStorage.n_list"><code class="xref py py-attr docutils literal notranslate"><span class="pre">n_list</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float64</span></code></a> of shape (N, Nt)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td><p>refractive indices for all ray sections</p></td>
</tr>
<tr class="row-odd"><td><p>Wavelength</p></td>
<td><p><a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.wl_list" title="optrace.tracer.ray_storage.RayStorage.wl_list"><code class="xref py py-attr docutils literal notranslate"><span class="pre">wl_list</span></code></a></p></td>
<td><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> of type <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="(in NumPy v2.3)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.float32</span></code></a> of shape N</p></td>
<td><p>nm</p></td>
<td><p>wavelength of the ray</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="direct-access">
<h3><span class="section-number">4.15.2.2. </span>Direct Access<a class="headerlink" href="#direct-access" title="Link to this heading">Â¶</a></h3>
<p>After raytracing, the ray storage is accessible as attribute of the Raytracer.
Value are accessed by typical numpy array indexing or slicing.
See the table above for the variable names and dimensions.
Number of rays and sections per ray is accessible through <code class="code highlight python docutils literal highlight-python"><span class="n">Raytracer</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">N</span></code> and <code class="code highlight python docutils literal highlight-python"><span class="n">Raytracer</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">nt</span></code>.</p>
<p>Letâ€™s create an example geometry:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># create raytracer</span>
</span><span data-line="2"><span class="n">RT</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Raytracer</span><span class="p">(</span><span class="n">outline</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># add RaySource</span>
</span><span data-line="5"><span class="n">RSS</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CircularSurface</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="6"><span class="n">RS</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">RaySource</span><span class="p">(</span><span class="n">RSS</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">])</span>
</span><span data-line="7"><span class="n">RT</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">RS</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># load LeGrand Eye model</span>
</span><span data-line="10"><span class="n">eye</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">presets</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">legrand_eye</span><span class="p">()</span>
</span><span data-line="11"><span class="n">RT</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">eye</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># trace</span>
</span><span data-line="14"><span class="n">RT</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</span></pre></div>
</div>
<p>To access positions of the third ray section write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">p_list</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
</span></pre></div>
</div>
<p>To access the wavelength of the tenth ray:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">wl_list</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
</span></pre></div>
</div>
<p>Access the position z-component of all sections of the twenty-third to twenty-sixth ray by writing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">p_list</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
</span></pre></div>
</div>
<p>Access the ray section lengths for the fourth section:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">ray_lengths</span><span class="p">()[:,</span> <span class="mi">3</span><span class="p">]</span>
</span></pre></div>
</div>
</section>
<section id="masking">
<h3><span class="section-number">4.15.2.3. </span>Masking<a class="headerlink" href="#masking" title="Link to this heading">Â¶</a></h3>
<p>For more control over accessing ray properties masking methods of the RayStorage class can be applied.
A call of <a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.rays_by_mask" title="optrace.tracer.ray_storage.RayStorage.rays_by_mask"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rays_by_mask</span></code></a> without parameters is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">rays_by_mask</span><span class="p">()</span>
</span></pre></div>
</div>
<p>â€¦ and returns a tuple of position, direction, polarization, weights, wavelengths, source number, refractive index.</p>
<p>Providing a boolean array as first parameter applies masks to all these elements:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span data-line="2"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">rays_by_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Providing an additional array of integers also selects the ray sections:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span data-line="2"><span class="n">sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
</span><span data-line="3"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">rays_by_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span>
</span></pre></div>
</div>
<p>By default, ray direction vectors are normalized, if this isnâ€™t needed, you can provide <code class="code highlight python docutils literal highlight-python"><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span data-line="2"><span class="n">sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
</span><span data-line="3"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">rays_by_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>
</div>
<p>You can restrict the properties by setting the <code class="code highlight python docutils literal highlight-python"><span class="n">ret</span></code> parameter.
All unneeded parameters are not calculated and set to <code class="code highlight python docutils literal highlight-python"><span class="kc">None</span></code>, speeding things up.
This parameter is a seven element bool list that marks all needed properties:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
</span><span data-line="2"><span class="n">RT</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">rays_by_mask</span><span class="p">(</span><span class="n">ret</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span>
</span></pre></div>
</div>
<p>The function still returns a tuple of 7 elements, but undesired elements have value <code class="code highlight python docutils literal highlight-python"><span class="kc">None</span></code> instead of an array.
See the code reference of <a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.ray_storage.RayStorage.rays_by_mask" title="optrace.tracer.ray_storage.RayStorage.rays_by_mask"><code class="xref py py-func docutils literal notranslate"><span class="pre">rays_by_mask</span></code></a> for more detail.</p>
</section>
</section>
<section id="object-descriptions">
<h2><span class="section-number">4.15.3. </span>Object Descriptions<a class="headerlink" href="#object-descriptions" title="Link to this heading">Â¶</a></h2>
<p>Child classes of <a class="reference internal" href="../reference/optrace_tracer.html#optrace.tracer.base_class.BaseClass" title="optrace.tracer.base_class.BaseClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseClass</span></code></a> include parameters <code class="code highlight python docutils literal highlight-python"><span class="n">desc</span><span class="p">,</span> <span class="n">long_desc</span></code>.
The former should be a short descriptive string and the latter a more verbose one.
These descriptions can be user provided and are used in for plotting and text output.</p>
</section>
<section id="modifying-initialized-objects">
<h2><span class="section-number">4.15.4. </span>Modifying Initialized Objects<a class="headerlink" href="#modifying-initialized-objects" title="Link to this heading">Â¶</a></h2>
<p>To avoid issues and hard-to-debug problems, some objects are <cite>locked</cite> after initialization.
This means object properties can not be changed or assigned.
Some objects include specific methods to change their properties after initialization.
For instance, changing a lens surface leads to a change of the lens, which in turn can lead to changes in the lens group or raytracer.
Such changes should only be applicable through specific functions that update everything accordingly in a defined way.</p>
<p>Locked objects/properties include:</p>
<ul class="simple">
<li><p>all surface types as well as lines and points</p></li>
<li><p>positions of geometrical objects (lens, detector, â€¦) (but these are assignable through a function)</p></li>
<li><p>surface assignment (but accessible through specific functions)</p></li>
<li><p>properties of rendered rays</p></li>
<li><p>a calculated ray transfer analysis object (TMA)</p></li>
</ul>
<p>The list of traced rays is read-only, since their properties should only be assigned by the simulation itself.</p>
</section>
<section id="color-conversions">
<span id="usage-color"></span><h2><span class="section-number">4.15.5. </span>Color Conversions<a class="headerlink" href="#color-conversions" title="Link to this heading">Â¶</a></h2>
<p>Color conversion are supported via the namespace <code class="code highlight python docutils literal highlight-python"><span class="n">optrace</span><span class="o">.</span><span class="n">color</span></code>.
optrace provides conversions for the colorspaces XYZ, sRGB, linear SRGB, CIELUV and xyY as well as some color properties like Saturation and Hue in CIELUV.</p>
<p>Check the <a class="reference internal" href="../details/color.html#color-management"><span class="std std-ref">Color Handling</span></a> section for a technical and fundamental descriptions of color processing and calculation.
Go to the code reference section <a class="reference internal" href="../reference/optrace_tracer_color.html#module-optrace.tracer.color" title="optrace.tracer.color"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optrace.tracer.color</span></code></a> for information on the usage of implemented functions.</p>
<p>For the sRGB Perceptual Rendering Intent there a extra parameters available.
For instance, a fixed saturation scaling can be set using the <code class="code highlight python docutils literal highlight-python"><span class="n">chroma_scale</span></code> parameter of the <a class="reference internal" href="../reference/optrace_tracer_color.html#optrace.tracer.color.srgb.xyz_to_srgb_linear" title="optrace.tracer.color.srgb.xyz_to_srgb_linear"><code class="xref py py-func docutils literal notranslate"><span class="pre">optrace.tracer.color.xyz_to_srgb_linear</span></code></a> function.
A suitable scaling factor can be calculated using <a class="reference internal" href="../reference/optrace_tracer_color.html#optrace.tracer.color.srgb.get_chroma_scale" title="optrace.tracer.color.srgb.get_chroma_scale"><code class="xref py py-func docutils literal notranslate"><span class="pre">optrace.tracer.color.get_saturation_scale</span></code></a>.
This is useful for viable comparison between images, as the saturation scaling factor is the same.
The function <a class="reference internal" href="../reference/optrace_tracer_color.html#optrace.tracer.color.srgb.xyz_to_srgb_linear" title="optrace.tracer.color.srgb.xyz_to_srgb_linear"><code class="xref py py-func docutils literal notranslate"><span class="pre">optrace.tracer.color.xyz_to_srgb_linear</span></code></a> provides the <code class="code highlight python docutils literal highlight-python"><span class="n">chroma_scale</span></code> parameter to override the best matching one.
Alternatively, a relative lightness threshold can be set using the <code class="code highlight python docutils literal highlight-python"><span class="n">L_th</span></code> parameter, which excludes colors of darker image regions to calculate/apply the factor in both functions.
This is helpful when the scaling factor is largely affected by color values that are mostly invisible.
If there still colors outside the gamut after the operation (for instance, because they were below <code class="code highlight python docutils literal highlight-python"><span class="n">L_th</span></code> or the user set <code class="code highlight python docutils literal highlight-python"><span class="n">chroma_scale</span></code> value was insufficient), they are projected onto the gamut edge as for the absolute rendering intent.
See the docstring of both functions for further information.</p>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="gui_automation.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title"><span class="section-number">4.14. </span>GUI Automation</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="../details/index.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title"><span class="section-number">5. </span>Implementation Details</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright">
      &copy; 2025, Damian Mendroch &nbsp;  &nbsp; 
      <a href="../impressum.html" style="color: var(--pst-color-text-muted)">Impressum</a>
      &nbsp; &nbsp; 
      <a href="../impressum.html" style="color: var(--pst-color-text-muted)">Legal Notice</a>
      <br>
  
    </div>
    <div class="sy-foot-copyright">
      <p>
        Made with
    
        <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
        <a href="https://shibuya.lepture.com">Shibuya theme</a>.
      </p>
    </div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5b045848"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/shibuya.js?v=e730760c"></script></body>
</html>