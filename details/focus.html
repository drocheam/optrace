<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>5.7. Focus Methods - optrace 1.7.5 documentation</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="5.8. Color Management" href="color.html" /><link rel="prev" title="5.6. PSF Convolution" href="convolution.html" />
      <link rel="canonical" href="https://drocheam.github.io/optrace/details/focus.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=a318c5d4" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=81da21d3" />
    <!--intentionally blank so there are no external fonts loaded-->
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://drocheam.github.io/optrace/details/focus.html"/>
  <meta property="og:title" content="5.7. Focus Methods"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>optrace</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href=".././examples.html">Examples</a></li><li class="link"><a href=".././installation.html">Installation</a></li><li class="link"><a href=".././usage/index.html">User Guide</a></li><li class="link">
          <a href="https://github.com/drocheam/optrace">
            <span>GitHub Repo</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><!--custom github logo so we don't need to connect to some icon provider-->
<div class="sy-head-socials"><a href="https://github.com/drocheam/optrace" aria-label="GitHub">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
  <a href="https://github.com/drocheam/optrace/releases" aria-label="Releases">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-icon lucide-package"><path d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"/><path d="M12 22V12"/><polyline points="3.29 7 12 12 20.71 7"/><path d="m7.5 4.27 9 5.15"/></svg>
  </a>
</div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../examples.html">1. Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">4. User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/overview.html">4.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/surfaces.html">4.2. Base Shapes (Surface, Line, Point)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/elements.html">4.3. Elements (Lens, Ray Source,  …)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/group.html">4.4. Geometry Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/raytracer.html">4.5. Raytracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/refraction_index.html">4.6. Refractive Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/spectrum.html">4.7. Spectrum Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/image.html">4.8. Image Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/focus.html">4.9. Focus Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/tma.html">4.10. Paraxial Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/convolve.html">4.11. PSF Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/plots.html">4.12. Plotting Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/gui.html">4.13. GUI Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/gui_automation.html">4.14. GUI Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/advanced.html">4.15. Advanced Topics</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">5. Implementation Details</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sampling.html">5.1. Property Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">5.2. Tracing Procedure</a></li>
<li class="toctree-l2"><a class="reference internal" href="hurb.html">5.3. Heisenberg Uncertainty Ray Bending</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_spectrum.html">5.4. Image and Spectrum Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrix_analysis.html">5.5. Ray Transfer Matrix Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="convolution.html">5.6. PSF Convolution</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.7. Focus Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="color.html">5.8. Color Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">5.9. Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">6. API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/structure.html">6.1. Library Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace.html">6.2. Global Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer.html">6.3. tracer Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_color.html">6.4. tracer.color Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_geometry.html">6.5. tracer.geometry Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_geometry_surface.html">6.6. tracer.geometry.surface Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_image.html">6.7. tracer.image Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_spectrum.html">6.8. tracer.spectrum Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_tracer_presets.html">6.9. tracer.presets Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_plots.html">6.10. plots Submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optrace_gui.html">6.11. gui Submodule</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">7. Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/testing.html">7.1. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/documentation.html">7.2. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/packaging.html">7.3. Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/notes.html">7.4. Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/changelog.html">7.5. Changelog</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#procedure">5.7.1. Procedure</a></li>
<li><a class="reference internal" href="#rms-spot-size">5.7.2. RMS Spot Size</a></li>
<li><a class="reference internal" href="#optimization-methods">5.7.3. Optimization Methods</a></li>
<li><a class="reference internal" href="#pixel-dimensions-for-rendering-methods">5.7.4. Pixel Dimensions for Rendering Methods</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">optrace</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name"><span class="section-number">5. </span>Implementation Details</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name"><span class="section-number">5.7. </span>Focus Methods</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://drocheam.github.io/optrace/_sources/details/focus.rst.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://drocheam.github.io/optrace/_sources/details/focus.rst.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://drocheam.github.io/optrace/_sources/details/focus.rst.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:code-slash"></iconify-icon>
            <span>View Source</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//drocheam.github.io/optrace/_sources/details/focus.rst.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//drocheam.github.io/optrace/_sources/details/focus.rst.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue" role="main">
          <section id="focus-methods">
<span id="autofocus"></span><h1><span class="section-number">5.7. </span>Focus Methods<a class="headerlink" href="#focus-methods" title="Link to this heading">¶</a></h1>
<section id="procedure">
<h2><span class="section-number">5.7.1. </span>Procedure<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<p>The focus search procedure is illustrated in the subsequent flowchart.</p>
<figure class="align-center" id="id4">
<a class="dark-light reference internal image-reference" href="../_images/FocusPAP.svg"><img alt="../_images/FocusPAP.svg" class="dark-light" src="../_images/FocusPAP.svg" width="400" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 5.21 </span><span class="caption-text">Autofocus process flowchart.</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rms-spot-size">
<h2><span class="section-number">5.7.2. </span>RMS Spot Size<a class="headerlink" href="#rms-spot-size" title="Link to this heading">¶</a></h2>
<p><strong>Standard RMS</strong></p>
<p>An analytical solution exists for the RMS spot size method.
The following derivation closely follows <a class="footnote-reference brackets" href="#footcite-boussemaere-2023-19" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
For ray sections that start at the coordinates <span class="math notranslate nohighlight">\(x_i, y_i, z_0\)</span>,
their positions at an additional axial distance <span class="math notranslate nohighlight">\(t\)</span> are given by:</p>
<div class="math-wrapper docutils container" id="equation-eq-rms-spot-size-propagation">
<div class="math notranslate nohighlight" id="equation-eq-rms-spot-size-propagation">
<span class="eqno">(5.163)<a class="headerlink" href="#equation-eq-rms-spot-size-propagation" title="Link to this equation">¶</a></span>\[\begin{split}x_i^*&amp;=x_i+\frac{s_{x, i}}{s_{z, i}} t \\
y_i^*&amp;=y_i+\frac{s_{y, i}}{s_{z, i}} t\end{split}\]</div>
</div>
<p>We can define the RMS spot size relative to the center coordinates <span class="math notranslate nohighlight">\(x_c^*, y_c^*\)</span>.
This average position also propagates, originating from <span class="math notranslate nohighlight">\(x_c, y_c\)</span> and possessing a direction vector <span class="math notranslate nohighlight">\(s_c\)</span>.
The cost function is:</p>
<div class="math-wrapper docutils container" id="equation-eq-rms-spot-size-cost-function">
<div class="math notranslate nohighlight" id="equation-eq-rms-spot-size-cost-function">
<span class="eqno">(5.164)<a class="headerlink" href="#equation-eq-rms-spot-size-cost-function" title="Link to this equation">¶</a></span>\[\begin{split}R_v(d) &amp;=\sqrt{\frac{1}{N} \sum_{i=1}^N\left(\left(x_i^*-x_c^*\right)^2+\left(y_i^*-y_c^*\right)^2\right)} \\
&amp;=\sqrt{\frac{1}{N} \sum_{i=1}^N\left(\left(\Delta x_i+d \Delta \theta_{x, i}\right)^2
+\left(\Delta y_i+d \Delta \theta_{y, i}\right)^2\right)}\end{split}\]</div>
</div>
<p>Introducing the new relative coordinates <span class="math notranslate nohighlight">\(\Delta x_i, \Delta y_i\)</span>
and the relative direction <span class="math notranslate nohighlight">\(\Delta \theta_{x,i}, \Delta \theta_{y,i}\)</span>:</p>
<div class="math-wrapper docutils container" id="equation-eq-rms-spot-size-relative-coordinates">
<div class="math notranslate nohighlight" id="equation-eq-rms-spot-size-relative-coordinates">
<span class="eqno">(5.165)<a class="headerlink" href="#equation-eq-rms-spot-size-relative-coordinates" title="Link to this equation">¶</a></span>\[\begin{split}\Delta x_i &amp; =x_i-x_c \\
\Delta y_i &amp; =y_i-y_c \\
\Delta \theta_{x, i} &amp; =\frac{s_{x, i}}{s_{z, i}}-\frac{s_{x, c}}{s_{z, c}} \\
\Delta \theta_{y, i} &amp; =\frac{s_{y, i}}{s_{z, i}}-\frac{s_{y, c}}{s_{z, c}}\end{split}\]</div>
</div>
<p>Applying variational calculus results in <a class="footnote-reference brackets" href="#footcite-boussemaere-2023-19" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>:</p>
<div class="math-wrapper docutils container" id="equation-eq-rms-spot-size-solution">
<div class="math notranslate nohighlight" id="equation-eq-rms-spot-size-solution">
<span class="eqno">(5.166)<a class="headerlink" href="#equation-eq-rms-spot-size-solution" title="Link to this equation">¶</a></span>\[t = -\frac{\sum_{i=1}^N \left(\Delta \theta_{x, i} \Delta x_i+\Delta \theta_{y, i} \Delta y_i \right)}
{\sum_{i=1}^N \left(\Delta \theta_{x, i}^2+\Delta \theta_{y, i}^2 \right)}\]</div>
</div>
<p>Thus, the focal position is located at <span class="math notranslate nohighlight">\(z_0 + t\)</span>.</p>
<p><strong>Ray Weighted RMS</strong></p>
<p>It is possible to include additional weights <span class="math notranslate nohighlight">\(w_i\)</span> for each ray, which can represent attributes such as ray power.</p>
<div class="math-wrapper docutils container" id="equation-eq-weighted-rms-spot-size-cost-function">
<div class="math notranslate nohighlight" id="equation-eq-weighted-rms-spot-size-cost-function">
<span class="eqno">(5.167)<a class="headerlink" href="#equation-eq-weighted-rms-spot-size-cost-function" title="Link to this equation">¶</a></span>\[\begin{split}R_v(d) =\sqrt{\frac{1}{N} \sum_{i=1}^N\left(\left(w_i\left(x_i^*-x_c^*\right)\right)^2
+\left(w_i\left(y_i^*-y_c^*\right)\right)^2\right)} \\\end{split}\]</div>
</div>
<p>The weights <span class="math notranslate nohighlight">\(w_i\)</span> can be isolated from the rest of the expression,
resulting in a factor of <span class="math notranslate nohighlight">\(w_i^2\)</span> for all terms. This yields a solution of:</p>
<div class="math-wrapper docutils container" id="equation-eq-weighted-rms-spot-size-solution">
<div class="math notranslate nohighlight" id="equation-eq-weighted-rms-spot-size-solution">
<span class="eqno">(5.168)<a class="headerlink" href="#equation-eq-weighted-rms-spot-size-solution" title="Link to this equation">¶</a></span>\[t = -\frac{\sum_{i=1}^N w_i^2 \left(\Delta \theta_{x, i} \Delta x_i+\Delta \theta_{y, i} \Delta y_i \right)}
{\sum_{i=1}^N w_i^2 \left(\Delta \theta_{x, i}^2 + \Delta \theta_{y, i}^2 \right)}\]</div>
</div>
<p><strong>Position Weighted RMS</strong></p>
<p>Utilizing other strictly monotonically increasing functions that depend on
<span class="math notranslate nohighlight">\(r^2 = \left(x_i^* - x_c^*\right)^2 + \left(y_i^* - y_c^*\right)^2\)</span> does not yield additional benefits.
These functions all share the same position for the minimum
but might present numerical challenges or be more complex to compute.
Due to its simplicity and convexity optimizing just <span class="math notranslate nohighlight">\(r^2\)</span> should be preferred.</p>
</section>
<section id="optimization-methods">
<h2><span class="section-number">5.7.3. </span>Optimization Methods<a class="headerlink" href="#optimization-methods" title="Link to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize" title="(in SciPy v1.16.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.optimize.minimize()</span></code></a> function, along with its optimization methods,
is utilized under the hood for various optimization tasks.</p>
<p>For the Irradiance Variance method, the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.minimize-neldermead.html#optimize-minimize-neldermead" title="(in SciPy v1.16.2)"><span class="xref std std-ref">Nelder-Mead</span></a>
solver is employed directly. This choice is based on the observation that the cost function is typically
smooth and straightforward to minimize in most situations.</p>
<p>In contrast, for the methods Image Sharpness and Image Center Sharpness,
the cost function tends to be much noisier and may include numerous local minima.
To address this challenge, the search region is initially sampled at multiple points.
Subsequently, minimization is initiated relative to the smallest found cost.
The <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.minimize-cobyla.html#optimize-minimize-cobyla" title="(in SciPy v1.16.2)"><span class="xref std std-ref">COBYLA</span></a> solver yields good results in these cases.</p>
</section>
<section id="pixel-dimensions-for-rendering-methods">
<h2><span class="section-number">5.7.4. </span>Pixel Dimensions for Rendering Methods<a class="headerlink" href="#pixel-dimensions-for-rendering-methods" title="Link to this heading">¶</a></h2>
<p>Methods such as Irradiance Variance, Image Sharpness, and Image Center Sharpness render multiple images
denoted as <span class="math notranslate nohighlight">\(P_z\)</span>, each with a pixel count of <span class="math notranslate nohighlight">\(N_\text{px} \cdot N_\text{px}\)</span>.</p>
<p>The side length in pixels, <span class="math notranslate nohighlight">\(N_\text{px}\)</span>, is influenced by the number of rays used for focus determination.
When working with a small number of rays, it is advantageous to keep <span class="math notranslate nohighlight">\(N_\text{px}\)</span> low to minimize noise effects.
Conversely, as the number of rays increases, <span class="math notranslate nohighlight">\(N_\text{px}\)</span> can be gradually increased to resolve finer details.
Distributing <span class="math notranslate nohighlight">\(N\)</span> rays over a square area necessitates increasing <span class="math notranslate nohighlight">\(N_\text{px}\)</span>
proportionally to <span class="math notranslate nohighlight">\(\sqrt{N}\)</span> to maintain a relatively consistent Signal-to-Noise Ratio (SNR).
The implemented formula follows the form <span class="math notranslate nohighlight">\(N_\text{px} = \text{offset} + \text{factor} \cdot \sqrt{N}\)</span>.</p>
<p>For simplicity, the same pixel count is used for both image dimensions.</p>
<hr class="docutils" />
<p><strong>References</strong></p>
<div class="docutils container" id="id3">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-boussemaere-2023-19" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>)</span>
<p>Luc Boussemaere. #DevOptical Part 19: a quick focus algorithm. 2023. URL: <a class="reference external" href="https://www.thepulsar.be/article/-devoptical-part-19--a-quick-focus-algorithm/">https://www.thepulsar.be/article/-devoptical-part-19–a-quick-focus-algorithm/</a> (visited on 2025-03-11).</p>
</aside>
</aside>
</div>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="convolution.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title"><span class="section-number">5.6. </span>PSF Convolution</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="color.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title"><span class="section-number">5.8. </span>Color Management</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright">
      &copy; 2026, Damian Mendroch &nbsp;  &nbsp; 
      <a href="../impressum.html" style="color: var(--pst-color-text-muted)">Impressum</a>
      &nbsp; &nbsp; 
      <a href="../impressum.html" style="color: var(--pst-color-text-muted)">Legal Notice</a>
      <br>
  
    </div>
    <div class="sy-foot-copyright">
      <p>
        Made with
    
        <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
        <a href="https://shibuya.lepture.com">Shibuya theme</a>.
      </p>
    </div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5b045848"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script>
      <script>window.MathJax = {"loader": {"load": ["ui/lazy"]}, "options": {"lazyMargin": "400px", "lazyAlwaysTypeset": null}}</script>
      <script defer="defer" src="../_static/mathjax/tex-chtml.js"></script></body>
</html>